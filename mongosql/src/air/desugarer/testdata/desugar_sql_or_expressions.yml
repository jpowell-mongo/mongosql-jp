tests:
  - name: "nothing to desugar"
    input:
      - { $match: { $expr: { $or: [ “$a”, “$b” ] } } }
    expected:
      - { $match: { $expr: { $or: [ “$a”, “$b” ] } } }
  - name: "Top Level OR"
    input:
      - { $match: { $expr: { $sqlOr: [ “$a”, “$b” ] } } }
    expected:
      - { $match: { $expr: { $or: [ “$a”, “$b” ] } } }
  - name: "OR with subquery containing filter stage with $sqlAnd (not flipped)"
    input:
      - { $match: { $expr: { $sqlOr: [ '$a', { $subqueryExists: { collection: 'bar', pipeline: [ { $match: { $expr: { $sqlAnd: [ '$b', '$c' ] } } } ] } } ] } } }
    expected:
      - { $match: { $expr: { $or: [ '$a', { $subqueryExists: { collection: 'bar', pipeline: [ { $match: { $expr: { $sqlAnd: [ '$b', '$c' ] } } } ] } } ] } } }
  - name: "OR with subquery containing filter stage with $sqlOr (both flipped)"
    input:
      - { $match: { $expr: { $sqlOr: [ '$a', { $subqueryExists: { collection: 'bar', pipeline: [ { $match: { $expr: { $sqlOr: [ '$b', '$c' ] } } } ] } } ] } } }
    expected:
      - { $match: { $expr: { $or: [ '$a', { $subqueryExists: { collection: 'bar', pipeline: [ { $match: { $expr: { $or: [ '$b', '$c' ] } } } ] } } ] } } }
  - name: "OR with $subquery in project stage with $sqlOr (not flipped in subquery)"
    input:
      - { $match: { $expr: { $sqlOr: [ '$a', { $subquery: { collection: 'bar', outputPath: [ 'x' ], pipeline: [ { $project: { x: { $sqlOr: [ '$b', '$c' ] } } } ] } } ] } } }
    expected:
      - { $match: { $expr: { $or: [ '$a', { $subquery: { collection: 'bar', outputPath: [ 'x' ], pipeline: [ { $project: { x: { $sqlOr: [ '$b', '$c' ] } } } ] } } ] } } }

  - name: "No desugar outside filter stages"
    input:
      - { $project: { _id: 0, expr: { $sqlOr: [ '$a', '$b' ] } } }
    expected:
      - { $project: { _id: 0, expr: { $sqlOr: [ '$a', '$b' ] } } }

  - name: "a AND (b OR C)"
    input:
      - { $match: { $expr: { $sqlAnd: [ '$a', { $sqlOr: [ '$b', '$c' ] } ] } } }
    expected:
      - { $match: { $expr: { $sqlAnd: [ '$a', { $or: [ '$b', '$c' ] } ] } } }
  - name: "OR with complex predicates"
    input:
    - { $match: { $expr: { $sqlOr: [ { $sqlGt: ['$a', 100] }, { $sqlGt: ['$b', 3000] } ] } } }
    expected:
      - { $match: { $expr: { $or: [ { $gt: ['$a', 100] }, { $gt: ['$b', 3000] } ] } } }
  - name: "OR nested expression - (a OR (b OR c))"
    input:
      - { $match: { $expr: { $sqlOr: [ '$a', { $sqlOr: [ '$b', '$c' ] } ] } } }
    expected:
      - { $match: { $expr: { $or: [ '$a', { $or: [ '$b', '$c' ] } ] } } }