tests:
  - name: "nothing to desugar"
    skip_reason: "ignore"
    input:
      - { $match: { $expr: { $or: [ “$a”, “$b” ] } } }
    expected:
      - { $match: { $expr: { $or: [ “$a”, “$b” ] } } }
  - name: "desugar top level $sqlOr"
    skip_reason: "ignore"
    input:
      - { $match: { $expr: { $sqlOr: [ “$a”, “$b” ] } } }
    expected:
      - { $match: { $expr: { $or: [ “$a”, “$b” ] } } }
# [TODO] nothing to desugar test that validates rewrites to or (and other sql semantic operators) only happens for filter stages
# [TODO] OR with Subsquery that has a filter stage with a sql semantic AND and it does not get flipped
# [TODO] OR with Subsquery that has a filter stage with a sql semantic or, and we validate that everything is flipped

  - name: "no desugar outside filter stages"
    skip_reason: "ignore"
    input:
      - { $project: { _id: 0, expr: { $sqlOr: [ '$a', '$b' ] } } }
    expected:
      - { $project: { _id: 0, expr: { $sqlOr: [ '$a', '$b' ] } } }

  - name: "a AND (b OR C)"
    input:
      - { $match: { $expr: { $sqlAnd: [ '$a', { $sqlOr: [ '$b', '$c' ] } ] } } }
    expected:
      - { $match: { $expr: { $sqlAnd: [ '$a', { $or: [ '$b', '$c' ] } ] } } }
  - name: "desugar complex $sqlOr"
    skip_reason: "ignore"
    input:
    - { $match: { $expr: { $sqlOr: [ { $sqlGt: ['$a', 100] }, { $sqlGt: ['$b', 3000] } ] } } }
    expected:
      - { $match: { $expr: { $or: [ { $gt: ['$a', 100] }, { $gt: ['$b', 3000] } ] } } }
  - name: "desugar nested $sqlOr (a OR (b OR c))"
    skip_reason: "ignore"
    input:
      - { $match: { $expr: { $sqlOr: [ '$a', { $sqlOr: [ '$b', '$c' ] } ] } } }
    expected:
      - { $match: { $expr: { $or: [ '$a', { $or: [ '$b', '$c' ] } ] } } }